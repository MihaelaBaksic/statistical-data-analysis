---
title: "Big Five – velikih pet dimenzija ličnosti"
author: "Filip Grebenar, David Konjevod, Lovre Mitrović, Mihaela Bakšić"
subtitle: Projekt iz predmeta Statistička analiza podataka, Fakultet elektrotehnike
  i računarstva
date: 14.1.2022.
output:
  pdf_document: default
  html_document:
    df_print: paged
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(nortest)
```


# Uvod

Ljudske osobine i njihova manifestacija često su istraživan fenomen. Trenutno dominantni model za klasifikaciju osobina ličnosti je Big Five model. Inicijalno je model bio razvijen s ciljem povezivanja osobina ličnosti i akademskih uspjeha i ponašanja. Barem četiri nezavisna skupa istraživača bavili su se problemom klasifikacija osobina ličnosti, te su svi diferencirali pet glavnih osobina ličnosti: ekstraverzija, ugodnost, savjesnost, neuroticizam i otvorenost. Bitno je naglasiti kako se ličnosti ne nalaze u ekstremima već na kontinuumu između ovih pet faktora.

Ekstraverzija se odnosi na interakciju s društvenom okolinom, podrazumjevajući snalaženje i volju osobe za druženjem i poduzetnost. 
Ugodnost predstavlja empatičnost i kooperativnost s drugima. 
Savjesnost vrednuje odnos prema obavezama i poslu te spontanost. 
Neuroticizam opisuje emocionalnu stabilnost osobe. 
Otvorenost razlikuje osobe prema otvorenosti novim konceptima i idejama.

Ovaj projekt predstavit će generalni pregled podataka, pokušati pronaći pravilnosti u podacima i modelirati ih. Također, pozabavit će se ispitivanjem nekih uvriježenih ideja i mišljenja o osobinama ličnosti.


# Skup podataka

Za svakog ispitanika u skupu podatka prisutne su vrijednosti za: državu, godine, spol, faktor ugodnosti, faktor ekstraverzije, faktor otvorenosti, faktor savjesnosti i faktor neuroticizma. Skup podataka ukupno sadrži
307313 zapisa. 
Prikazani su osnovni podaci deskriptivne statistike za cijeli skup podataka. U nastavku će se dodatno prikazati i analizirati deskriptivna statistika za varijable i podskupove podataka ovisno o potrebi problema koji se obrađuje.
Također, vidimo da su podaci potpuni, tj. nema vrijednosti koje nedostaju, što je odlika dobrog skupa podataka.

```{r}
bigfive = read.csv("./big_five_scores.csv")
head(bigfive)
nrow(bigfive)
summary(bigfive)
sum(is.na(bigfive$country))
sum(is.na(bigfive$age))
sum(is.na(bigfive$sex))
sum(is.na(bigfive$agreeable_score))
sum(is.na(bigfive$extraversion_score))
sum(is.na(bigfive$openness_score))
sum(is.na(bigfive$conscientiousness_score))
sum(is.na(bigfive$neuroticism_score))
```




# Testiranje razlika u otvorenosti kod mladih i starih ispitanika

Često je prisutna pretpostavka kako su mladi ljudi otvoreniji novim iskustvima od starih. Stoga, provest će se testiranje te pretpostavke. Mladim ljudima smatrat će se svi stari 30 ili manje godina, dok će se starim ljudima smatrati oni stari 60 ili više godina. Idemo li korak dalje, može li se uspostaviti jasna veza između dobi ispitanika i njihove otvorenosti? Može li se ta veza modelirati linearnom regresijom?

```{r, out.width= "65%"}
cat('Medijan godina svih ispitanika je ', median(bigfive$age),'\n')
old_subjects = bigfive[bigfive$age >= 60 ,]
young_subjects = bigfive[bigfive$age <= 30 ,]
cat('Srednja vrijednost otvorenosti za mlade ( <= 30 godina ) ispitanike je ', mean(young_subjects$openness_score), '\n')
cat('Srednja vrijednost otvorenosti za stare ( >= 60 godina ) ispitanike je ', mean(old_subjects$openness_score), '\n')
cat('Varijanca otvorenosti za mlade ( <= 30 godina ) ispitanike je ', var(young_subjects$openness_score), '\n')
cat('Varijanca otvorenosti za stare ( >= 60 godina ) ispitanike je ', var(old_subjects$openness_score), '\n')
boxplot(old_subjects$openness_score, young_subjects$openness_score, 
        names = c('Older subjects\' openness score','Younger subjects\' openness score'),
        main='Boxplot of younger and older subjects\' openness score')
hist(bigfive$openness_score,main='Openness score histogram',xlab='Value',ylab='Frequency', breaks=100)
```
Deskriptivnom analizom podatka dolazimo do saznanja o razlici u srednjim vrijednostima faktora otvorenosti za mlade i stare sudionike. 

## Normalnost podataka
```{r, out.width= "65%"}
hist(old_subjects$openness_score,main='Openness score old subjects histogram',xlab='Value',ylab='Frequency', breaks=100)
hist(young_subjects$openness_score,main='Openness score young subjects histogram',xlab='Value',ylab='Frequency', breaks=100)
qqnorm(old_subjects$openness_score, pch = 1, frame = FALSE,main='Older subjects')
qqline(old_subjects$openness_score, col = "steelblue", lwd = 2)
qqnorm(young_subjects$openness_score, pch = 1, frame = FALSE,main='Younger subjects')
qqline(young_subjects$openness_score, col = "steelblue", lwd = 2)
```
Iz histograma i qq-plotova za openness_score mladih i starih ispitanika može se naslutiti kako podaci pripadaju normalnoj razdiobi. Ta pretpostavka pokušat će se dodatno potvrditi provođenjem Lillieforsove inačice Kolmogorov-Smirnovljevog testa. Za sve testove unutar ovog podzadatka koristi se razina značajnosti \(\alpha = 0.05\).

### Testiranje normalnosti - Lillieforsova inačica Kolmogorov-Smirnovljevog testa


Testiranje normalnosti otvorenosti za starije ispitanike
```{r}
lillie.test(old_subjects$openness_score)
```
S obzirom da je p-vrijednost = 0.000517 < \(\alpha\), nulta hipoteza o pripadnosti podataka o otvorenosti starih ispitanika normalnoj raspodijeli se odbacije u korist alternativne hipoteze.

Testiranje normalnosti faktora otvorenosti za mlađe ispitanike
```{r}
lillie.test(young_subjects$openness_score)
```

S obzirom da je p-vrijednost < 2.2e-16 < \(\alpha\), nulta hipoteza o pripadnosti podataka o otvorenosti mladih ispitanika normalnoj raspodjeli se odbacije u korist alternativne hipoteze.


# Testiranje jednakosti varijanci otvorenosti za stare i mlade ispitanike

Testiranje jednakosti varijanci provodi se F testom. Pretpostavlja se nezavisnost uzoraka.

Hipoteze:

$$H_0: \sigma^2_{old} = \sigma^2_{young} $$
$$ H_1: \sigma^2_{old} \neq \sigma^2_{young}  $$
```{r}
var.test(old_subjects$openness_score, young_subjects$openness_score)
```
S obzirom da je p-vrijednost =  2.084e-06 < \(alpha\)odbacujemo hipotezu \(H_0 : \sigma^2_{old} = \sigma^2_{young} \) u korist alternativne hipoteze \( H_1: \sigma^2_{old} \neq \sigma^2_{young} \). Zaključujemo da podatci govore u prilog alternativnoj hipotezi i u testovima koji slijede koristit će se informacija o nejednakosti varijanci dobivena ovim testom.

# Testiranje jednakosti srednjih vrijednosti otvorenosti za stare i mlade ispitanike

Testiranje jednakosti srednjih vrijednosti T testom zahtjeva da podaci dolaze iz normalne razdiobe. Prethodno provedenim Lillieforsovim testom normalnosti pokazalo se da to ne vrijedi niti za podatke o otvorenosti mladih niti starih ispitanika. Ipak, histogrami i qq-plot grafovi prikazuju razdiobu koja nije daleko od normalne. Uzevši u obzir oblik grafova i veliku osjetljivost Lillieforsovog testa normalnosti, možemo nastaviti testiranje T testom uz pretpostavku normalnosti podataka.


Testiranje jednakosti srednjih vrijednosti otvorenosti za stare i mlade ispitanike provodi se kao T test za podatke s različitim varijancama, kako je pokazano prethodnim testom. Pretpostavlja se nezavisnost uzoraka.

Hipoteze:

$$H_0: \mu_{old} = \mu_{young}$$
$$ H_1: \mu_{old} \neq \mu_{young}  $$

```{r}
t.test(old_subjects$openness_score, young_subjects$openness_score, alt = "two.sided", var.equal = FALSE)
```
p-vrijednost = 0.00163 < \(\alpha\), stoga se hipoteza \( H_0: \mu_{old} = \mu_{young} \) odbacuje u korist alternativne hipoteze \(H_1: \mu_{old} \neq \mu_{young}\). 

Statističkim testiranjem pokazano je kako postoji statistički značajna razlika između srednjih vrijednosti otvorenosti mladih i starih ispitanika, sukladno često prisutnom mišljenju. Ova informacija ponukala nas je da pokušamo jasno modelirati vezu između tih dviju varijabli.


## Model linearne regresije za modeliranja odnosa godina i otvorenosti kod ispitanika


S obzirom na činjenicu da smo prethodnim testovima pokazali da je razlika između srednjih vrijednosti otvorenosti za mlade i stare ispitanike statistički značajna, vrijedilo bi se pozabaviti pitanjem odnosa između varijabli godina (age) i otvorenosti (openness_score). Za modeliranje ovisnosti koristi se model linearne regresije. Kako bi se dobio dojam o mogućoj zavisnosti varijable koja ocjenjuje otvorenost ispitanika i njihovih godina, prikazan je grafički prikaz u obliku scatter-plota.

```{r,  out.width= "65%"}
plot(bigfive$age,bigfive$openness_score)
```
Ipak, na temelju izgleda grafa moglo bi se zaključiti da veza između varijabli ne postoji ili nije statistički značajna. Kako bi se moglo preciznije diskutirati o tom pitanju, nastavit će se s modeliranjem njihvog odnosa modelom linearne regresije i provođenjem testova nad modelom, unatoč sugestiji grafičkog prikaza da je korelacija između varijabli vrlo slaba. Na temelju ocjene sposobnosti modela linearne regresije da modelira prikupljene podatke, ocjenit će se i njihova linearna zavisnost. Izlazna varijabla u modelu je openness_score, dok je varijabla age regresor. S obzirom da je priutan samo jedan regresor, koristi se jednostavna linearna regresija.

```{r}
selected.model = lm(openness_score~age,data=bigfive)
```

### Provjera pretpostavki modela

Prije svega treba provjeriti pretpostavke modela. Prva pretpostavka modela linearne regresije je da su reziduali normalno distribuirani i imaju homogenu varijancu. S obzirom da je korišten model jednostavne regresije, nije potrebno baviti se pretpostavkom o slaboj međusobnoj koreliranosti regresora.

```{r,  out.width= "65%"}
hist(rstandard(selected.model), breaks=100)
qqnorm(rstandard(selected.model))
qqline(rstandard(selected.model))
```
Histogram reziduala je vrlo obečavajuć te snažno podupire pretpostavku o normalnosti reziduala. Ipak, potrebno je provesti i Koglomorov-Smirnovljev test kako bi se normalnost insinuirana histogramom potvrdila. Za ovu namjenu, umjesto Lillieforsovog testa koristi se KS test, jer baratamo sa standardiziranim rezidualima, za koje očekujemo da će KS test dati bolje rezultate.

```{r}
ks.test(rstandard(selected.model), 'pnorm')
```
S obzirom da je p-vrijednost < \(\alpha\), nulta hipoteza o normalnosti standardiziranih reziduala se odbija u korist alternativnoj hipotezi. S obzirom na izgled histograma, izgled qq-plota i robusnost T-testa, ipak se može govoriti o dovoljnoj normalnosti reziduala za daljnja testiranja i evaluaciju modela.


Za ocjenu kvalitete modela koristi se koeficjent determinacije \(R^2\), koji odgovara udjelu varijance zavisne varijable koju objašnjava dani model.


```{r}
summary(selected.model)
```

\(R^2\) za procjenjeni model iznosi 0.0003563, što je izrazito niska vrijednost. Oba parametra modela također imaju izuzetno malu p-vrijednost, čime ih se ne može smatrati statistički značajnim. Također, p-vrijednost za F-test signifikantnosti modela je daleko ispod \(\alpha\). Uzimajući ove ocjene modela u obzir, možemo sa velikom sigurnošću tvrditi kako je model linearne regresije neadekvatan odabir za modeliranje odnosa između godina i otvorenosti ispitanika. S obzirom na izgled scatter plota odnosa te dvije varijable, može se reći da je rezultat i očekivan.


# Savjesnost između regija
## Uvod

U ovom dijelu bavimo se pitanjem imaju li neke regije značajno različite rezultate u određenom faktoru. Primjerice je li opravdan mit o visokoj savjesnosti populacije istočne Azije naspram populacije drugih kontinenata.

Regije sam podijelio na osnovu UN-ove podjele (izvor:"https://unstats.un.org/sdgs/indicators/regional-groups/").

```{r,  out.width= "65%"}
`%!in%` <- Negate(`%in%`)
region_east_asian =c('Brunei','Cambodia','China','Hong Kong','Indonesia','Japan','Macau', 'Malaysia', 'Mongolia','Burma(Myan','North Kore', 'Philippine','Singapore','South Kore','Burma', 'Thailand','Vietnam', 'Taiwan','Borneo')
east_asia = bigfive[bigfive$country %in% region_east_asian,]
rest_regions = bigfive[bigfive$country %!in% region_east_asian,]
summary(bigfive$conscientiousness_score)
summary(east_asia$conscientiousness_score)
summary(rest_regions$conscientiousness_score)
cat('Varijanca savjesnosti za istočnu aziju ', var(east_asia$conscientiousness_score), '\n')
cat('Varijanca savjesnosti za ostatak svijeta ', var(rest_regions$conscientiousness_score), '\n')
boxplot(east_asia$conscientiousness_score, rest_regions$conscientiousness_score, 
        names = c('Istocna Azija\ savjesnost','Ostatak svijeta savjesnost'),
        main='Boxplot za istocnu Aziju i ostatak svijeta savjesnost')
hist(bigfive$conscientiousness_score,main='Savjesnost histogram',xlab='Value',ylab='Frequency', breaks=100)
```

```{r,  out.width= "65%"}
hist(east_asia$conscientiousness_score,main='Histogram savjesnosti istocne Azije',xlab='Value',ylab='Frequency', breaks=100)
hist(rest_regions$conscientiousness_score,main='Histogram savjesnosti ostatka svijeta',xlab='Value',ylab='Frequency', breaks=100)
qqnorm(east_asia$conscientiousness_score, pch = 1, frame = FALSE,main='Istocna Azija')
qqline(east_asia$conscientiousness_score, col = "steelblue", lwd = 2)
qqnorm(rest_regions$conscientiousness_score, pch = 1, frame = FALSE,main='Ostatak svijeta')
qqline(rest_regions$conscientiousness_score, col = "steelblue", lwd = 2)
```
Već iz priloženih grafova može se naslutiti da su obje distribucije normalne te suprotno početnom pitanju izgleda da je savjesnost ispitanika istočne Azije manja nego u ostatku svijeta.

## Testiranje normalnosti distribucije

Hipoteze:

H_0: distribucija east_asia$conscientiousness_score pripada normalnoj razdiobi
H_1: distribucija east_asia$conscientiousness_score NE pripada normalnoj razdiobi

```{r}
lillie.test(east_asia$conscientiousness_score)
```
Na osnovu p vrijednosti od 5.76e-08 odbacujemo nultu hipotezu u korist alternative da se savjesnost ispitanika istočne Azije ne ravna po normalnoj distribuciji.

Hipoteze:

H_0: distribucija rest_regions$conscientiousness_score pripada normalnoj razdiobi
H_1: distribucija rest_regions$conscientiousness_score NE pripada normalnoj razdiobi

```{r}
lillie.test(rest_regions$conscientiousness_score)
```
Na osnovu p vrijednosti od 2.2e-18 odbacujem nultu hipotezu u korist alternative da se savjesnost ispitanika iz ostalih regija ne ravna po normalnoj distibuciji.

Uzevši u obzir preveliku osjetljivost ovog testa i činjenicu da je iz histograma vidljiva normalnost u nastavku pretpostavljam normalnost za obje populacije.

## Testiranje jednakosti varijance savjesnosti

Pretpostavljamo nezavisnost uzoraka i izvodim F test.

Hipoteze:

$$H_0: \sigma^2_{east Asia} = \sigma^2_{rest}$$
$$H_1: \sigma^2_{east Asia} \neq \sigma^2_{rest}  $$
```{r}
var.test(east_asia$conscientiousness_score, rest_regions$conscientiousness_score)
```
Na osnovu male p vrijednosti odbacujemo nultu hipotezu u korist alternative da su varijance distribucije različite


## Testiranje jednakosti razine savjesnosti

Koristimo T test i pretpostavljam nezavisnost varijabli i različitost varijanci te normalnu razdiobu.

Hipoteze:

$$H_0: \mu_{eastAsia} = \mu_{rest}$$ 
$$ H_1: \mu_{eastAsia} > \mu_{rest}  $$

```{r}
t.test(east_asia$conscientiousness_score,rest_regions$conscientiousness_score, alt = "greater", var.equal = FALSE)
```
Uz veliku p vrijednost nismo uspjeli odbaciti nultu hipotezu i zaključujem nije opravdan mit o visokoj savjesnosti populacije istočne Azije.

## Savjesnost između više regija
### Uvod

Pošto se nismo uvjerili u ispravnost mita da su stanovnici istočne Azije savjesniji od ostatka svijeta pitam postoji li uopće razlike u savjesnosti između stavnika različitih regija. Za primjer ćemo uzeti tri regije za koje imamo sličan broj podataka. Naše pitanje glasi: "Postoji li razlika u savjesnosti između latinske Amerike,  sjeverne Afrike i zapadne Azije(arapskog svijeta) i centralne Azije"

```{r,  out.width= "65%"}
region_latin_america = c('Argentina', 'Anguilla', 'Trinidad a', 'Chile', 'Mexico', 'Brazil', 'Bahamas', 'Haiti', 'Cayman Isl', 'Puerto Ric', 'British Vi', 'Columbia', 'Ecuador', 'Peru', 'Venezuela', 'Aruba', 'Cuba', 'Antigua', 'Suriname', 'Dominican', 'Costa Rica', 'Jamaica', 'Grenada', 'El Salvado', 'Honduras', 'St Lucia', 'Barbados', 'Virgin Isl', 'Panama', 'Belize', 'Guatemala', 'Guyana', 'Paraguay', 'Gabon', 'Uruguay', 'Faeroe Isl', 'Bolivia', 'Nicaragua', 'Turks and', 'Dominica', 'French Gui', 'Saint Kitt', 'Guadeloupe', 'St Vincent', 'Gambia')
region_north_africa_and_west_asia = c('Syria', 'Egypt', 'Turkey', 'Algeria', 'Kuwait', 'Israel', 'Lebanon', 'Arabian Gu', 'Georgia', 'Saudi Arab', 'Azerbaijan', 'Jordan', 'Iraq', 'Tunisia', 'Bahrain', 'United Ara', 'Sudan', 'Oman', 'Armenia', 'Yemen', 'Qatar', 'Morocco', 'Western Sa', 'Libyan Ara')
region_central_asia = c('India', 'Afghanista', 'Bangladesh', 'Pakistan', 'Iran', 'Turkmenist', 'Nepal', 'Sri Lanka', 'Bhutan', 'Kazakhstan', 'Maldives', 'Uzbekistan')

latin_america = bigfive[bigfive$country %in% region_latin_america,]
arabic_world = bigfive[bigfive$country %in% region_north_africa_and_west_asia,]
central_asia = bigfive[bigfive$country %in% region_central_asia,]
```
```{r}
summary(latin_america$conscientiousness_score)
summary(arabic_world$conscientiousness_score)
summary(central_asia$conscientiousness_score)
boxplot(latin_america$conscientiousness_score,arabic_world$conscientiousness_score,central_asia$conscientiousness_score, 
        names = c('Latinska amerika','Arapski svijet','Centralna\n Azija'),
        main='Boxplot savjesnosti za zadane regije')
```


```{r,  out.width= "65%"}
hist(latin_america$conscientiousness_score,main='Histogram savjesnosti Latinske Amerike',xlab='Value',ylab='Frequency', breaks=100)
qqnorm(latin_america$conscientiousness_score, pch = 1, frame = FALSE,main='Savjesnost Latinske Amerike')
qqline(latin_america$conscientiousness_score, col = "steelblue", lwd = 2)
hist(arabic_world$conscientiousness_score,main='Histogram savjesnosti Arapskog svijeta',xlab='Value',ylab='Frequency', breaks=100)
qqnorm(arabic_world$conscientiousness_score, pch = 1, frame = FALSE,main='Savjesnost Arapski svijet')
qqline(arabic_world$conscientiousness_score, col = "steelblue", lwd = 2)
hist(central_asia$conscientiousness_score,main='Histogram savjesnosti centralne Azije',xlab='Value',ylab='Frequency', breaks=100)
qqnorm(central_asia$conscientiousness_score, pch = 1, frame = FALSE,main='Savjesnost centralne Azije')
qqline(central_asia$conscientiousness_score, col = "steelblue", lwd = 2)
```

Iz histograma i qq plota je vidljivo da se savjesnost svih zadanih regija ravna po normalnoj razdiobi.

### Testiranje normalnosti distribucije

Hipoteze:

H_0: distribucija regije pripada normalnoj razdiobi
H_1: distribucija regije NE pripada normalnoj razdiobi

```{r test normalnosti}
lillie.test(latin_america$conscientiousness_score)
lillie.test(arabic_world$conscientiousness_score)
lillie.test(central_asia$conscientiousness_score)
```
Za savjesnost svake regije na Lillieforovom testu smo dobili izuzetno malenu p vrijednost te odbacujemo nultu hipotezu za svaku regiju. Zaključak na osnovu Lillieforova testa jest da se nijedna distribucija savjesnosti ne ravna po normalnoj razdiobi. Ali na osnovu histograma i qq plota u nastavku pretpostavljamo da se svaka distibucija savjesnosti ravna po normalnoj razdiobi.

### Testiranje homogenosti varijance između populacija

Nulta hipoteza je da su varijance savjesnosti svih regija jednake. Alternativa je da nisu odnosno da se barem jedan par varijanci razlikuje.

$$ \begin{aligned}
  H_0 & : \sigma_{latin America}^2 = \sigma_{arabic World}^2 = \sigma_{centralAsia}^2 \\
  H_1 & : \neg H_0.
\end{aligned} $$

Za testiranje ove hipoteze koristimo Bartlettov test.

```{r test pretpostavki - homogenost varijanci,  out.width= "65%"}
score = c(latin_america$conscientiousness_score,arabic_world$conscientiousness_score,central_asia$conscientiousness_score)

la_vec = rep(c("latin_america"),length(latin_america$conscientiousness_score))
arb_vec = rep(c("arabic_world"),length(arabic_world$conscientiousness_score))
asi_vec = rep(c("central_asia"),length(central_asia$conscientiousness_score))
region = c(la_vec,arb_vec,asi_vec)

df = data.frame(region,score)

bartlett.test(df$score ~ df$region)

var(latin_america$conscientiousness_score)
var(arabic_world$conscientiousness_score)
var(central_asia$conscientiousness_score)
```
Na osnovu p vrijednosti od 0.01102 odbacujemo nultu hipotezu i zaključujem da varijance ove tri populacije nisu homogene. Ali za potrebe testiranja u nastavku pretpostavljamo da jesu.

### Testiranje jednakosti savjesnosti

Provjeravamo postoje li razlike u savjesnosti između regija. Kao nultu hipotezu pretpostavljamo da sve odabrane regije imaju jednako očekivanje razinu savjesnosti naspram alternativne hipoteze da nemaju to jest da barem jedan par regija nema jednako očekivanje za razinu savjesnosti.

$$ \begin{aligned}
  H_0 & : \mu_{latinAmerica}^2 = \mu_{arabicWorld}^2 = \mu_{centralAsia}^2 \\
  H_1 & : \neg H_0.
\end{aligned} $$

U svrhu testiranja naših hipoteza koristit ćemo ANOVA test. Zbog pretpostavki ANOVA testa pretpostavljam da su distribucije normalne, varijance homogene i podaci nezavisni.

```{r test anova - jednakost savjesnosti,  out.width= "65%"}
# Test
a = aov(df$score ~ df$region)
summary(a)
```

Na osnovu p vrijednosti od 0.00167 odbacujemo nultu hipotezu u korist alternative da očekivanje razine savjesnosti nije isto za svaku odabranu regiju.








# Motivacija: Možemo li zaključiti nešto o jednoj osobini uzimajući kao ulazne varijable jednu ili više preostalih osobina?

Ono što očekujemo je da ne bi smjela postojati visoka korelacija između pojedinih osobina ličnosti pošto svaka od njih na jedinstven način opisuje određeni element ljudske osobnosti. Uz ovih 5, poznat je i velik broj drugih osobina, ali ovih 5 je izabrano na način da u idealnom slučaju u potpunosti definiraju osobnost neke osobe i razlikuju je od osobnosti drugih pojedinaca.

Kao izlaznu varijablu proizvoljno smo odabrali neuroticizam, a pregledavajući znanstvenu literaturu došli smo do zaključka da bi ekstraverzija mogla u najvećoj mjeri objasniti varijaciju u neuroticizmu što donekle i ima smisla jer osobe koje su introverti teže artikuliraju svoje emocije te su skloniji anksioznosti i depresiji.

Kako bismo mogli bolje uočiti potencijalnu vezu dviju varijabli, uzet ćemo slučajan poduzorak našeg ulaznog skupa podataka.


```{r}
bigfive1 = bigfive[sample(nrow(bigfive),2000),]
plot(bigfive1$extraversion_score, bigfive1$neuroticism_score)
smoothScatter(bigfive$extraversion_score, bigfive$neuroticism_score)

```

Scatter plot pokazuje da postoji negativan efekt varijable extraversion_score na izlaznu varijablu neuroticism_score, odnosno osobe koje postiže nizak score na ekstraverziji, postižu visok score na neuroticizmu.
Zato ćemo pokušati kreirati model jednostavne regresije koji uključuje spomenute varijable:
$$Y = \beta_0 + \beta_1x_1 + \epsilon$$
Pritom pretostavljamo da je \(\epsilon\) normalno distribuirana slučajna varijabla (pogreška) s homogenom varijancom te da su pritom \(\epsilon\) 1, \(\epsilon\) 2, ..., \(\epsilon\) n međusobno nezavisne, odnosno nekorelirane slučajne varijable.

```{r}
fit.neuroticism = lm(neuroticism_score ~ extraversion_score, data = bigfive)
smoothScatter(bigfive$extraversion_score, bigfive$neuroticism_score)
lines(bigfive$extraversion_score, fit.neuroticism$fitted.values, col = "red")

```
Sada ćemo provjeriti pretpostavke o normalnosti reziduala i homogenosti varijance. To ćemo učiniti grafički pomoću histograma i q-q plota te statističkim testovima - Kolmogorov-Smirnovljev test i Lillieforsova korekcija.

```{r}
hist(rstandard(fit.neuroticism), probability = TRUE, breaks = 30) 
y <- seq(min(rstandard(fit.neuroticism)), max(rstandard(fit.neuroticism)), 0.01)
lines(y, dnorm(y, mean(rstandard(fit.neuroticism)), sd(rstandard(fit.neuroticism))), col = "red", lwd = 3) 
```
Iz histograma se može naslutiti normalna distribucija. Vidimo da se graf funkcije gustoće vjerojatnosti normalne slučajne varijable s parametrima uzoračke distribucije prilično dobro podudara s funkcijom gustoće vjerojatnosti varijable neuroticism_score.

```{r}
qqnorm(rstandard(fit.neuroticism))  
qqline(rstandard(fit.neuroticism))
```
q-q plot pokazuje da se kvantili uzoračke distribucije u velikoj mjeri slažu s teorijskim kvantilima normalne distribucije. U repovima distribucije postoje manja odstupanja što možemo objasniti mogućim postojanjem outliera.

```{r}
smoothScatter(fit.neuroticism$fitted.values, rstandard(fit.neuroticism))
```
Iz scatter plota koji pokazuje standardizirane reziduale u odnosu na procjene modela uočavamo da nema naznake nehomogenosti pogreške.

```{r}
ks.test(rstandard(fit.neuroticism), "pnorm")
require(nortest)
lillie.test(rstandard(fit.neuroticism))
```
Iz p vrijednost KS-testa možemo zaključiti da uz nivo značajnosti od 5% ne možemo odbaciti nultu hipotezu o normalnosti, dok iz Lillieforsove inačice možemo izvući isti zaključak. 

Važno je napomenuti da u ovom slučaju KS-test je bolji izbor s obzirom da standardizacijom reziduala njihovo teoretsko očekivanje je nula i varijanca jedan. Mi u ovom slučaju KS-testom uspoređujemo uzoračku distribuciju s jediničnom normalnom razdiobom. Lillieforsova inačica dizajnirana je više za slučaj kada ne poznajemo ni varijancu ni očekivanje varijabli, već ih procjenjujemo iz uzorka.

```{r}
fit.neuroticism = lm(neuroticism_score ~ extraversion_score, data = bigfive)
summary(fit.neuroticism)
```
Iz p vrijednost t testova možemo zaključiti da su oba koeficijenta statistički značajna uz bilo koju razinu značajnosti. Uz to f test je pokazao da je i cijeli model signifikantan. Ipak, nizak koeficijent determinacije pokazuje da je jako mali dio promjena zavisne varijable, konkretno 17.84% objašnjeno dobivenim modelom jednostavne linearne regresije.

Osim ekstraverzije kao potencijalne osobine iz koje bismo mogli nešto zaključiti o neuroticizmu osobe, pokazalo se da bi još jedna osobina u Big Five modelu mogla objašnjavati rezultat koji osoba postiže na neuroticizmu, a to je savjesnost. To možemo interpretirati time da osobe koje su nediscplinirane, neuredne i nemaju rutinu mogu biti sklonije neurotičnom ponašanju od savjesnih i organiziranih ljudi.


```{r}
plot(bigfive1$conscientiousness_score, bigfive1$neuroticism_score)
```

Iz scatter plota možemo uočiti naznaku negativne korelacije, odnosno zavisnosti dviju varijabli što odgovara našoj početnoj tezi. Kako bismo kvantificirali navedenu korelaciju, možemo izračunati Pearsonov korelacijski koeficijent za ove dvije varijable, a dodatno možemo pogledati korelacijsku tablicu svih 5 faktora što će nam pomoći i u kreiranju modela višestruke regresije i provjere njenih prepostavki.


```{r}

correlations <- cor(cbind(bigfive$agreeable_score,bigfive$extraversion_score, bigfive$openness_score, bigfive$conscientiousness_score, bigfive$neuroticism_score))

colnames(correlations) <- c("agreeable_score", "extraversion_score", "openness_score", "conscientiousness_score", "neuroticism_score")
rownames(correlations) <- c("agreeable_score", "extraversion_score", "openness_score", "conscientiousness_score", "neuroticism_score")

library(corrplot)
corrplot(correlations, method = "number")

cor.test(bigfive$extraversion_score, bigfive$neuroticism_score)

```

Iz korelacijske tablice naslućujemo da postoji određena veza između varijabli neuroticism_score i conscientiousness_score. Ono što također možemo uočiti je da nema kršenja pretpostavki, tj. da nema značajne korelacije između dviju varijabli extraversion_score i conscientiousness_score što nam ujedno pokazuje i t-test Pearsonovog korelacijskog koeficijenta tih dviju varijabli.

```{r}
fit.neuroticism_m = lm(neuroticism_score ~ extraversion_score + conscientiousness_score, bigfive)
summary(fit.neuroticism_m)
```

Iz modela multivarijantne regresije možemo uočiti da su svi koeficijenti, a uz to i sam model signifikantni uz bilo koju razinu značajnosti. Također, koeficijent determinacije se povećao u odnosu na model jednostavne regresije što znači da je conscientiousness_score doprinio poboljšanju funkcije ovisnosti izlazne varijable o regresorima, odnosno da je veća proporcija varijacije varijable Y objašnjena ovim modelom.

```{r}
hist(rstandard(fit.neuroticism_m))
ks.test(rstandard(fit.neuroticism_m), "pnorm")
```
Iz grafičkog prikaza i KS-testa zaključujemo da nema kršenja pretpostavke normalnosti reziduala.


Možemo probati uključiti i preostala dva faktora u model multivarijantne regresije.
```{r}
fit.multi = lm(neuroticism_score ~ extraversion_score + conscientiousness_score + agreeable_score + openness_score, bigfive)
summary(fit.multi)
```

Vidimo da su opet svi koeficijenti kao i sam model signifikantni do na bilo koju razinu značajnosti. Uz to, iz procjena nepoznatih parametara zaključujemo da najveći efekt na izlaznu varijablu imaju regresori extraversion_score i conscientiousness_score. Povećanje koeficijenta determinacije postoji, ali je zanemarivo pa možemo zaključiti da dodani faktori ne objašnjavaju u značajnijoj mjeri neobjašnjenu varijaciju modela s postojeća dva faktora. Ono što bismo u ovom slučaju očekivali je da se prilagođeni koefcijent determinacije koji penalizira dodatne parametre smanji, ali pošto se radi o jako velikom uzorku izostao je takav efekt.


```{r}
hist(rstandard(fit.multi))
ks.test(rstandard(fit.multi), "pnorm")
```
Iz grafičkog prikaza i KS-testa zaključujemo da nema kršenja pretpostavke normalnosti reziduala.


Sada ćemo pokušati primijeniti isti model na muškarce starije od 22 godina.
```{r}
fit.multi = lm(neuroticism_score ~ extraversion_score + conscientiousness_score + agreeable_score + openness_score, bigfive[bigfive$sex == 1 & bigfive$age > 22,])

summary(fit.multi)
```
Signifikantnost koeficijenata i modela ostala je statistički značajna, ali vidimo da se koeficijent determinacije povećao. Razlog tome je što se za osobnost mladih ljudi smatra da je još u razvoju te je sukladno tome sklona većim varijacijama od one kod starijih ljudi (https://www.tandfonline.com/doi/abs/10.1080/10478401003596626).
Uz to, pokazalo se da ukoliko se promatraju samo ispitanici muškog spola, da model još bolje objašnjava varijaciju izlazne varijable.

```{r}
hist(rstandard(fit.multi))
ks.test(rstandard(fit.multi), "pnorm")
```
Iz grafičkog prikaza i KS-testa zaključujemo da nema kršenja pretpostavke normalnosti reziduala.





#### Karakteristike prema spolu ispitanika
Postoje li razlike u karakteristikama prema spolu ispitanika? Možemo li temeljem nekih drugih varijabli odrediti spol ispitanika? Želimo ispitati postoje li dovoljne razlike između rezultata testiranja između pripadnika različitih spolova da bi mogli na temelju rezultata ispitivanja odrediti je li test rješavala žena ili muškarac.

Kako bismo mogli predvidjeti spol ispitanika, možemo ispitati različite varijable koje bi mogle utjecati na spol:

- Neuroticism_score
- Agreeableness_score
- Conscientiousness_score
- Extraversion_score
- Openness/Intellect
- Age 

Prvi korak je razvrstati podatke u dvije grupe - muškarci i žene. Konkretno u ovome skupu 1 predstavlja muški spol, dok 2 predstvlja ženski spol.

```{r}
male_subjects = bigfive[bigfive$sex == 1 ,]
female_subjects = bigfive[bigfive$sex == 2 ,]
```
Zatim možemo usporediti srednje vrijednosti za 5 kategorija kako bi uočili po kojim karateristikama se najviše razlikuju spolovi:
```{r,  out.width= "65%"}
cat("Razlika između srednji vrijednosti:\n")
srednja_vrijednost <- matrix(c(
  mean(female_subjects$neuroticism_score),
  mean(female_subjects$extraversion_score),
  mean(female_subjects$agreeable_score),
  mean(female_subjects$conscientiousness_score),
  mean(female_subjects$openness_score),
  mean(male_subjects$neuroticism_score),
  mean(male_subjects$extraversion_score),
  mean(male_subjects$agreeable_score),
  mean(male_subjects$conscientiousness_score),
  mean(male_subjects$openness_score)),ncol=2)
colnames(srednja_vrijednost) <- c("Žene","Muškarci")
rownames(srednja_vrijednost) <- c("neuroticism_score","extraversion_score","agreeable_score", "conscientiousness_score", "openness_score")
srednja_vrijednost <- as.table(srednja_vrijednost)
print(srednja_vrijednost)
cat("\nRazlika između varijanci:\n")
varijance <- matrix(c(
  var(female_subjects$neuroticism_score),
  var(female_subjects$extraversion_score),
  var(female_subjects$agreeable_score),
  var(female_subjects$conscientiousness_score),
  var(female_subjects$openness_score),
  var(male_subjects$neuroticism_score),
  var(male_subjects$extraversion_score),
  var(male_subjects$agreeable_score),
  var(male_subjects$conscientiousness_score),
  var(male_subjects$openness_score)),ncol=2)
colnames(varijance) <- c("Žene", "Muškarci")
rownames(varijance) <- c("neuroticism_score","extraversion_score","agreeable_score", "conscientiousness_score", "openness_score")
varijance <- as.table(varijance)
print(varijance)
```
Nakon što usporedimo srednje vrijednosti prema svih 5 faktora, može se uočiti da između nekih postoji veća, odnosno manja razlika. Iako razlike nisu velike želimo ispitati postoji li mogućnost procjene spola na temelju ovih faktora. Također, najveća razlika se uočava između neuroticizma, ugodnosti i otvorenosti dok je između savjesnosti i ekstraverzije ona gotovo zanemariva. Prikazali smo podatke grafički kako bismo provjerili njihovu normalnost te pokušali uočiti vizualne karakteristike.

## Vizualizacija podataka
```{r}
boxplot(male_subjects$openness_score, female_subjects$openness_score, 
        names = c('Male subjects\'openness_score','Female subjects\' openness_score'),
        main='Boxplot of male and female subjects\' openness_score')
boxplot(male_subjects$neuroticism_score, female_subjects$neuroticism_score, 
        names = c('Male subjects\' neuroticism score','Female subjects\' neuroticism score'),
        main='Boxplot of male and female subjects\' neuroticism_score')
boxplot(male_subjects$agreeable_score, female_subjects$agreeable_score, 
        names = c('Male subjects\'agreeable_score','Female subjects\' agreeable_score'),
        main='Boxplot of male and female subjects\' agreeable_score')

```


Možemo uočiti razliku u srednjoj vrijednosti neuroticizma između pripadnika ženskog i muškog spola. Stoga postoje indikacije da bi neuroticism_score trebao biti viši kod žena nego muškaraca pa ćemo tu hipotezu testirati t-testom.
Prije samog testiranja moramo provjeriti pretpostavke nezavisnosti i normalnosti.

Pošto je u ovom slučaju nezavisnost zadovoljena, sljedeći korak je provjeriti normalnost podataka koju najčešće provjeravamo: histogramom, qq-plotom te KS-testom kojim provjeravamo pripadnost podataka distribuciji. 


Sljedeće testove radimo samo za neuroticizam uz pretpostavku da se za ostale faktore podaci slično ponšaju.

```{r, fig.width = 14, fig.height=5}
hist(male_subjects$neuroticism_score,main='Male neuroticsm score histogram', xlab='value', ylab='Frequency')
hist(female_subjects$neuroticism_score,main='Female neuroticsm score histogram', xlab='value', ylab='Frequency')
```
Histogrami upućuju na normalnost podataka.

```{r}
qqnorm(male_subjects$neuroticism_score, pch = 1, frame = FALSE,main='Male subjects')
qqline(male_subjects$neuroticism_score, col = "steelblue", lwd = 2)

qqnorm(female_subjects$neuroticism_score, pch = 1, frame = FALSE,main='Female subjects')
qqline(female_subjects$neuroticism_score, col = "steelblue", lwd = 2)
```
Uzorački kvantili uglavnom se slažu s teorijskim kvantilima normalne distribucije osim u repovima distribucije gdje postoje manja odstupanja.


# Testiranje normalnosti - Lillieforsova inačica Kolmogorov-Smirnovljevog testa

Hipoteze:

H_0: distribucija male_subjects$neuroticism_score pripada normalnoj razdiobi 
H_1: distribucija male_subjects$neuroticism_score NE pripada normalnoj razdiobi

```{r}
lillie.test(male_subjects$neuroticism_score)
```

Hipoteze:

H_0: distribucija female_subjects$neuroticism_score pripada normalnoj razdiobi
H_1: distribucija female_subjects$neuroticism_score NE pripada normalnoj razdiobi

```{r}
lillie.test(female_subjects$neuroticism_score)
```
S obzirom da je p-vrijednost < \(\alpha\), odbacujemo nultu hipotezu u korist alternative da se neuroticizam muških/ženskih ispitanika ne ravna po normalnoj distibuciji, što je suprotno od onoga što smo uočili u grafovima. Uzevši u obzir oblik grafova, osjetljivost Lillieforsovog testa normalnosti i robusnosti t-testa na nenormalnost u slučaju velikog uzorka, možemo nastaviti testiranje uz pretpostavku normalnosti podataka.

# Testiranje jednakosti varijanci neuroticizma za muške/ženske ispitanike

Pretpostavljam nezavisnost uzoraka i izvodim F-test.

Hipoteze:

$$H_0: \sigma^2_{Male} = \sigma^2_{Female}$$
$$H_1: \sigma^2_{Male} \neq \sigma^2_{Female}  $$
```{r}
var.test(male_subjects$neuroticism_score, female_subjects$neuroticism_score)
```
Na osnovu male p vrijednosti odbacujem nultu hipotezu u korist alternative da su varijance distribucije različite.

# Testiranje jednakosti srednjih vrijednosti neuroticizma za muške/ženske ispitanike
Kako bismo mogli provoditi t-test uzorci moraju biti nezavisni i dolaziti iz normalne distribucije. Nezavisnost možemo utvrditi sa sigurnošću pošto je svaki ispitanik neovisan o drugom, odnosno svaki čovjek je zaseban pojedinac te njegovi rezultati ne ovise o rezultatima drugog pojedinca. Normalnost podataka smo ispitali histogramima, qq-plotovima i statističkim testovima.

Koristimo t-test i pretpostavljamo nezavisnost varijabli i nejednakost varijanci.

Hipoteze:

$$H_0: \mu_{Female} = \mu_{Male}  $$
$$H_1: \mu_{Female} > \mu_{male}  $$

```{r}
t.test(female_subjects$neuroticism_score ,male_subjects$neuroticism_score, alt = "greater", var.equal = FALSE)

```
p-vrijednost je manja od 0.05, stoga se hipoteza \( H_0: \mu_{Female} = \mu_{Male} \) odbacuje u korist alternativne hipoteze \(H_1: \mu_{female} > \mu_{Male}  \)


Osim neuroticizma za koji smo statističkim testiranjem utvrdili da se razlikuje između spolova, osobina koja bi se potencijalno također mogla pokazati kao razlikovni faktor između spolova jest ugodnost (https://www.frontiersin.org/articles/10.3389/fpsyg.2011.00178/full).
Možemo grafički prikazati ovisnost tih dviju varijabli te istaknuti razliku u spolovima.

```{r}
bigfive1 = bigfive[sample(nrow(bigfive),2000),]

plot(bigfive1$agreeable_score, bigfive1$neuroticism_score )

plot(bigfive1[bigfive1$sex == 1,]$agreeable_score, bigfive1[bigfive1$sex == 1,]$neuroticism_score, col = "blue")

points(bigfive1[bigfive1$sex == 2,]$agreeable_score, bigfive1[bigfive1$sex == 2,]$neuroticism_score, col = "red")
```
Iz scatter plota možemo uočiti razliku u osobinama između muškog i ženskog spola, odnosno da žene generalno postižu veći score na neuroticizmu i ugodnosti.

Ovo nam daje tračak nade da bismo možda iz velikog skupa podataka mogli kreirati logistički model regresije pomoću kojega ćemo pomoću varijabli neuroticism_score i agreeableness_score pokušati predvidjeti kojeg je spola ispitanik.

## Model logističke regresije za klasifikaciju spola ispitanika
```{r}
require(ISLR)
```

Kako bismo dobili binarnu varijablu za spol prilagodit ćemo varijablu spola tako da 0 predstavlja muški, a 1 ženski spol.
```{r}
data = bigfive
data$sex = data$sex - 1
```

```{r}
model <- glm(sex ~ neuroticism_score + agreeable_score, data = data, family = binomial)
summary(model)
Rsq = 1 - model$deviance/model$null.deviance
Rsq
```
Iz rezultata modela možemo uočiti da su svi koeficijenti statistički signifikantni uz bilo koju razinu značajnosti. Usporedbom devijanci null-modela i našeg modela pomoću $R^2$ možemo zaključiti da je naš model bolji, ali ne pretjerano dobar.

U procjeni kvalitete modela koristit ćemo i tzv. matricu zabune iz koje ćemo očitati kolika je točnost našeg modela.
```{r}
yHat <- model$fitted.values > 0.5
tab <- table(data$sex, yHat)
tab
accuracy = sum(diag(tab)) / sum(tab)
accuracy
```
Vidimo da je udio točno klasificiranih primjera oko 67%.

Možemo pokušati u model uvrstiti i preostale ulazne varijable našeg dataseta kako bismo dobili kvalitetniji model.
```{r}
model1 = glm(sex ~ agreeable_score + extraversion_score + openness_score + conscientiousness_score + neuroticism_score + age, data = data, family = binomial())
summary(model)
Rsq = 1 - model1$deviance/model$null.deviance
Rsq
```
Možemo uočiti da je svaki score ponovno signifikantan, dok je varijabla age uz razinu značajnosti od 5% statistički nesignifikantna. Vidimo da se $R^2$ povećao u odnosu na prvotni model što je pozitivno, a daljnjom analizom utvrdit ćemo je li kvalitetniji.

```{r analiza modela}
yHat <- model$fitted.values > 0.5
tab <- table(data$sex, yHat)
tab
accuracy = sum(diag(tab)) / sum(tab)
accuracy
```
Model daje točnost od oko 69% što je svakako bolje od slučajnog pogađanja spola, ali i povećanje u odnosu na prvotni model pa naslućujemo da je ovaj model kvalitetniji. To ćemo provjeriti tako što ćemo testirati devijance ova dva modela.
```{r}
anova(model, model1, test = "LRT")
```
Likelihood ratio test (LRT) pokazao je da postoji značajna razlika u devijancama te možemo zaključiti kako uz dodatne preostale faktore, naš model ima veću kvalitetu. 
Međutim, ono što ne možemo je tvrditi da sa velikom vjerojatnosti na temelju samo rezultata faktora možemo predvidjeti spol.


